<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>구글 스프레드시트 데이터</title>
  <style>
    .data-list {
      list-style-type: none;
      padding: 0;
    }
    .data-list li {
      margin-bottom: 10px;
    }
    .author {
      color: blue;
      font-weight: bold;
    }
    img {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <h1>구글 스프레드시트 데이터</h1>
  <p id="data">불러오는 중...</p>

  <ul class="data-list" id="data-list"></ul>

  <script>
    fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vS51SDANoy5EhKuTDgyn_Z_9KTC-_0X8V_H5dGi7bWpmuuSZF2yDbw517p_EDKMD5Ic3iK5TjNC19Al/pub?output=csv')
      .then(response => response.text())
      .then(data => {
        const rows = data.split('\n'); // CSV 데이터 라인별로 나누기
        let list = document.getElementById('data-list');
        
        // "불러오는 중..." 텍스트 제거
        document.getElementById('data').style.display = 'none';

        // 데이터를 1부터 시작 (헤더는 제외하고)
        for (let i = 1; i < rows.length; i++) {
          const columns = rows[i].split(','); // 각 행을 콤마로 구분

          if (columns.length < 9) continue; // 9개 열이 없는 행은 건너뜀

          // D열 값 (작성자)
          const dValue = columns[3];  // D열은 4번째 열
          
          // H열 값 (글자)
          let hValue = columns[7];  // H열은 8번째 열
          // I열 값 (이미지 URL)
          let iValue = columns[8];  // I열은 9번째 열

          let j = 8; // I열부터 시작
          
          // I열에 https로 시작하는 URL이나 빈칸이 아닌 값이 있을 때, 그 값을 I열로 처리하고
          // 그 이전 값들은 모두 H열로 합쳐야 한다
          while (j < columns.length && (columns[j] && !columns[j].startsWith('http') && columns[j].trim() !== '')) {
            hValue += ", " + columns[j]; // https나 빈칸이 아닌 경우 계속해서 H열로 합친다
            j++;
          }

          // 그 이후에 https로 시작하는 URL이 나오면 I열로 처리
          if (j < columns.length && (columns[j].startsWith('http') || columns[j].startsWith('https'))) {
            iValue = columns[j]; // I열에 유효한 이미지 URL을 할당
          } else {
            iValue = ''; // I열이 비어있거나 잘못된 값이라면 비워두기
          }

          // D열 (작성자) 리스트 항목 생성
          const listItemD = document.createElement('li');
          listItemD.classList.add('author');
          listItemD.innerText = `작성자: ${dValue}`;
          list.appendChild(listItemD);

          // H열 (글자) 리스트 항목 생성
          const listItemH = document.createElement('li');
          listItemH.innerText = `글자: ${hValue}`;
          list.appendChild(listItemH);

          // I열 (이미지) 리스트 항목 생성 (이미지가 있을 경우만 표시)
          if (iValue && (iValue.startsWith('http') || iValue.startsWith('https'))) {
            const listItemI = document.createElement('li');
            const imgElement = document.createElement('img');
            const decodedURL = decodeURIComponent(iValue); // URL 디코딩 처리

            // URL을 콘솔에 출력
            console.log("이미지 URL:", decodedURL); // 여기에서 URL이 정상적으로 출력되는지 확인

            // 이미지를 HTML에 표시
            imgElement.src = decodedURL;
            imgElement.alt = '관련 이미지';
            
            listItemI.appendChild(imgElement);
            list.appendChild(listItemI);

            // 디버깅용으로 URL을 화면에 표시
            const urlDisplay = document.createElement('p');
            urlDisplay.innerText = `이미지 URL: ${decodedURL}`;
            list.appendChild(urlDisplay);
          } else if (!iValue || iValue.trim() === '') {
            // I열이 비어 있으면 그 값을 출력하지 않음
            console.log("I열에 이미지 URL이 없습니다.");
          }
        }
      })
      .catch(error => console.error('Error fetching data: ', error));
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>구글 스프레드시트 데이터</title>
  <style>
    .data-list {
      list-style-type: none;
      padding: 0;
    }
    .data-list li {
      margin-bottom: 10px;
    }
    .author {
      color: blue;
      font-weight: bold;
    }
    img {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <h1>구글 스프레드시트 데이터</h1>
  <p id="data">불러오는 중...</p>

  <ul class="data-list" id="data-list"></ul>

  <script>
    // PapaParse 라이브러리 사용
fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vS51SDANoy5EhKuTDgyn_Z_9KTC-_0X8V_H5dGi7bWpmuuSZF2yDbw517p_EDKMD5Ic3iK5TjNC19Al/pub?output=tsv')
  .then(response => response.text())
  .then(data => {
    // PapaParse로 TSV 데이터를 파싱
    Papa.parse(data, {
      complete: function(results) {
        console.log(results);  // 결과 확인 (디버깅용)

        // 파싱된 데이터의 각 행 처리
        let list = document.getElementById('data-list');
        
        // "불러오는 중..." 텍스트 제거
        document.getElementById('data').style.display = 'none';

        // 데이터 시작 (헤더 제외)
        for (let i = 1; i < results.data.length; i++) {
          const row = results.data[i];

          // D열 값 (작성자)
          const dValue = row[3];  // D열은 4번째 열 (인덱스 3)
          // H열 값 (글자)
          const hValue = row[7];  // H열은 8번째 열 (인덱스 7)
          // I열 값 (이미지 URL)
          const iValue = row[8];  // I열은 9번째 열 (인덱스 8)

          // D열 (작성자) 리스트 항목 생성
          const listItemD = document.createElement('li');
          listItemD.classList.add('author');
          listItemD.innerText = `작성자: ${dValue}`;
          list.appendChild(listItemD);

          // H열 (글자) 리스트 항목 생성
          const listItemH = document.createElement('li');
          listItemH.innerText = `글자: ${hValue}`;
          list.appendChild(listItemH);

          // I열 (이미지) 리스트 항목 생성 (이미지가 있을 경우만 표시)
          if (iValue && (iValue.startsWith('http') || iValue.startsWith('https'))) {
            const listItemI = document.createElement('li');
            const imgElement = document.createElement('img');
            const decodedURL = decodeURIComponent(iValue); // URL 디코딩 처리

            // URL을 콘솔에 출력
            console.log("이미지 URL:", decodedURL); // 여기에서 URL이 정상적으로 출력되는지 확인

            // 이미지를 HTML에 표시
            imgElement.src = decodedURL;
            imgElement.alt = '관련 이미지';
            
            listItemI.appendChild(imgElement);
            list.appendChild(listItemI);

            // 디버깅용으로 URL을 화면에 표시
            const urlDisplay = document.createElement('p');
            urlDisplay.innerText = `이미지 URL: ${decodedURL}`;
            list.appendChild(urlDisplay);
          } else {
            // 만약 URL이 아니면, 그 값을 출력하지 않도록 처리
            console.log("I열에 URL이 없습니다.");
          }
        }
      }
    });
  })
  .catch(error => console.error('Error fetching data: ', error));


  </script>
</body>
</html>
